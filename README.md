# NER для анализа неструктурированных данных об угрозах в области информационной безопасности (тестовое задание)

**Цель работы:** реализовать сервис, для извлечения именованных сущностей 
из текстов отчетов исследователей ИБ.

## Подготовка данных и обучение модели
Предварительно исходный датасет(https://github.com/valeleriee/ml_engineer) 
был скачан в папку dataset.

Данные из каталогов были агрегированя в csv таблицу (см. ./dataset/dataset.csv), 
для дальнейшего удобства работы с ним.

В ходе работы были отмечены деффекты разметки, которые частично пришлось устранять вручную.
Из-за множественных дефектов разметки и пересечении меток сущностей в пределах одного слова
(часто встречались случаи где одно слово размечено несколькими тэгами), было принято решение 
извлечь имена сущностей и теги и использовать их при обучении ner-модели.

Обучение проводилось с помощью облачного сервиса Google Colab.
Для построения NER-модели используется open-source библиотека Python - spaCy для решения NLP задач.
В отличие от NLTK она предоставляет возможность обучить кастомную NER-модель.

**В качестве развития этой части проекта можно сделать следующее:**
1. Попробовать другие сервисы/способы разметки, 
так как представленный набор данных имеет множество деффектов, 
на устранение которых уходит значительное время. 
При использовании пайплайнов spaCy в дальнейшем, понадобятся следующее содержание данных:
индекс начала слова в исходном тексте, индекс конца слова, метка сущности. 
Такая форма необходима для учета контекста при токенизации текста перед обучением. 
Пример: 
`TRAIN_DATA = [
    ('Who is Nastya?',[(7, 12, 'PERSON')]),
    ('I like Moscow and Vitalik.', [(7, 13, 'LOC'), (18, 24, 'PERSON')])
...)`
2. Провести несколько экспериментов с обучением модели меняя количество итераций, 
соотношение при делении на тестовую и валидационную выборку, величину коэффициента для dropout и т.п. 
Цель подхода: поиск оптимальной модели, качественно решающей свою задачу
3. Увеличить/сбалансировать набор данных. Из статистики по извлеченным именованным сущностям 
из исходного набора данных можно заметить, что наблюдается значительный дисбаланс в количестве примеров на класс сущности.
Это можно решить увеличением набора данных и различными подходами балансировки(SMOTE, Tomek Links, ADASYN)


**Пример подготовки данных для обучения и статистики :**  

<a href="https://colab.research.google.com/github/anastasiyaperk/NERTestTask/tree/master/examples/prepare_dataset.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a> 

**Статистика по извлеченным сущностям в исходном наборе данных:**

<a href="https://colab.research.google.com/github/anastasiyaperk/NERTestTask/tree/master/examples/entities_statistic.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a> 

**Процесс обучения и тестирования модели:**

<a href="https://colab.research.google.com/github/anastasiyaperk/NERTestTask/tree/master/examples/train_process.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a> 

**Пример модели, обученной на верно размеченных данных:**

<a href="https://colab.research.google.com/github/anastasiyaperk/NERTestTask/tree/master/examples/train_example.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a> 


## Развертывание Flask-приложения
1. В корне проекта необходимо выполнить команду:  
`docker-compose up --build`

2. После сборки docker образа и развертывания контейнера,
в консоли будет отображен хост и порт, по которому доступен сервис


## Использование сервиса
Сервис предоставляет по url host:port/get_entities возможность 
извлечения именованных сущностей из текста.  

Для получения результата, необходимо отправить POST запрос по указаному url, 
передав в теле запроса json-сообщение в формате `{"text":"<SOURCE_TEXT>"}`.  
В качестве ответа будет возвращен json-ответ содержащий имена 
извлеченных сущностей и соответствующие им теги:  
` {
    "<ENTITY1>": "<TAG1>",
    "<ENTITY2>": "<TAG2>", ...
}` .  

**Пример:**

Тело POST-запроса: `{"text":"Microsoft"}`  
Ответ: `{"Microsoft": "MALWARE"}`  
